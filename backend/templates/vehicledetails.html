<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vehicle Details</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vehicledetails.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="details-page">
    
    <div class="bg-image"></div>
    <div class="bg-overlay"></div>

    <div class="main-container">
        
        <header class="page-header">
            <a href="/dashboard" class="back-btn">‚Üê Back to Dashboard</a>
            <h1 class="page-title">Vehicle Insights</h1>
        </header>

        <div class="details-grid">
            
            <div class="left-col">
                <div class="card profile-card">
                    <div class="img-wrapper">
                        <img id="v-image" src="/static/img/car-interior.jpg" alt="Car Image" class="vehicle-img">
                        <div class="camera-overlay" id="btn-change-photo" title="Change Photo">üì∑</div>
                        <input type="file" id="upload-photo-input" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="profile-header">
                        <h2 id="v-title">Loading...</h2>
                        <div class="badges">
                            <span id="v-plate" class="badge">---</span>
                        </div>
                    </div>

                    <div class="stats-box">
                        <div class="stat-row">
                            <span class="label">Mileage</span>
                            <div class="val-group">
                                <span class="val" id="v-mileage">--- km</span>
                                <button id="btn-quick-mileage" class="btn-icon" title="Update Mileage">‚úèÔ∏è</button>
                            </div>
                        </div>
                        <div class="stat-row">
                            <span class="label">VIN</span>
                            <span class="val mono" id="v-vin">---</span>
                        </div>
                        <div class="stat-row">
                            <span class="label">Color</span>
                            <span class="val" id="v-color">---</span>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button id="btn-edit-vehicle" class="btn-outline">Edit Details</button>
                        <button id="btn-delete-init" class="btn-danger">Delete</button>
                    </div>
                </div>
            </div>

            <div class="right-col">
                <div class="card graph-card">
                    <div class="card-header"><h3>Mileage Forecast</h3></div>
                    <div class="chart-container"><canvas id="maintenanceChart"></canvas></div>
                </div>

                <div class="card list-card">
                    <div class="card-header"><h3>Upcoming Maintenance</h3></div>
                    <div id="predictions-list" class="scroll-list">
                        <p class="empty-text">Loading...</p>
                    </div>
                </div>

                <div class="card list-card">
                    <div class="card-header">
                        <h3>Service History</h3>
                        <button id="btn-add-record" class="btn-sm">+ Add Record</button>
                    </div>
                    <div id="history-list" class="scroll-list">
                        <p class="empty-text">Loading...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-record-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Service Details</h3>
                <span class="close-modal" data-target="view-record-modal">&times;</span>
            </div>
            <div class="record-detail-content">
                <h2 id="view-type">...</h2>
                <p class="detail-date" id="view-date">...</p>
                <div class="detail-row"><span>Mileage:</span><strong id="view-mileage">...</strong></div>
                <div class="detail-row"><span>Cost:</span><strong id="view-cost">...</strong></div>
                <div class="detail-notes-box"><label>Notes:</label><p id="view-notes">...</p></div>
                <button class="btn-outline close-view-modal" style="margin-top:20px; width:100%;">Close</button>
            </div>
        </div>
    </div>

    <div id="add-record-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3 id="add-modal-title">Add Service Record</h3>
                <span class="close-modal" data-target="add-record-modal">&times;</span>
            </div>
            <form id="add-service-form">
                <p id="add-error-msg" class="error-text" style="display:none;"></p>
                <div class="form-group">
                    <label>Service Type</label>
                    <select id="s-type" required>
                        <option value="oil_change">Oil Change</option>
                        <option value="tire_rotation">Tire Rotation</option>
                        <option value="brake_service">Brake Service</option>
                        <option value="air_filter">Air Filter</option>
                        <option value="battery">Battery Check</option>
                        <option value="timing_belt">Timing Belt</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label>Date</label>
                        <input type="date" id="s-date" required>
                    </div>
                    <div class="form-group half">
                        <label>Mileage (km)</label>
                        <input type="number" id="s-mileage" required min="0">
                    </div>
                </div>
                <small id="logic-error" class="field-error" style="display:none; margin-bottom:10px;"></small>
                <div class="form-group">
                    <label>Cost</label>
                    <input type="number" id="s-cost" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="s-notes" rows="3"></textarea>
                </div>
                <button type="submit" id="btn-save-service" class="btn-primary">Save Record</button>
            </form>
        </div>
    </div>

    <div id="edit-vehicle-modal" class="modal-overlay">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Edit Vehicle Details</h3>
                <span class="close-modal" data-target="edit-vehicle-modal">&times;</span>
            </div>
            <form id="edit-vehicle-form">
                <p id="edit-error-msg" class="error-text" style="display:none;"></p>
                
                <div class="form-group">
                    <label>License Plate</label>
                    <input type="text" id="edit-plate" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group half">
                        <label>Color</label>
                        <input type="text" id="edit-color">
                    </div>
                    <div class="form-group half">
                        <label>Year</label>
                        <input type="number" id="edit-year" min="1900">
                    </div>
                </div>
                
                <button type="submit" id="btn-save-edit" class="btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <div id="delete-modal" class="modal-overlay">
        <div class="modal-card" style="text-align: center;">
            <h3 style="color: #ff3b30; margin-bottom: 10px;">Delete Vehicle?</h3>
            <p style="color: #666; margin-bottom: 25px;">
                Are you sure you want to delete <b id="delete-veh-name">this vehicle</b>?<br>This action cannot be undone.
            </p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-outline close-delete" style="flex:1;">Cancel</button>
                <button id="btn-confirm-delete" class="btn-danger" style="flex:1;">Yes, Delete</button>
            </div>
        </div>
    </div>

    <div id="delete-record-modal" class="modal-overlay">
        <div class="modal-card" style="text-align: center;">
            <h3 style="color: #ff3b30; margin-bottom: 10px;">Delete Record?</h3>
            <p style="color: #666; margin-bottom: 25px;">
                Are you sure you want to remove this service record?
            </p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-outline close-record-delete" style="flex:1;">Cancel</button>
                <button id="btn-confirm-record-delete" class="btn-danger" style="flex:1;">Yes, Delete</button>
            </div>
        </div>
    </div>

    <div id="update-mileage-modal" class="modal-overlay">
        <div class="modal-card modal-small">
            <div class="modal-header">
                <h3>Update Mileage</h3> <span class="close-modal" data-target="update-mileage-modal">&times;</span>
            </div>
            <form id="update-mileage-form">
                <div class="form-group">
                    <label>Current Mileage (km)</label>
                    <input type="number" id="quick-mileage-input" required>
                    <small id="quick-mileage-error" class="field-error" style="display:none;"></small>
                </div>
                <button type="submit" id="btn-save-mileage" class="btn-primary">Update</button>
            </form>
        </div>
    </div>

    <script>const API_BASE_URL = window.location.origin;</script>
    <script src="{{ url_for('static', filename='js/vehicle-details.js') }}"></script>
</body>
</html>
